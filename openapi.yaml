openapi: 3.0.3
info:
  title: Рыбное хранилище
  version: 1.0.0
  description: |
    Сервис управления объектами иерархии Fish/FreshwaterFish/SaltwaterFish.
    Уникальные идентификаторы назначаются на сервере и возвращаются в ответах.
servers:
  - url: https://api.example.com
paths:
  /list:
    get:
      summary: Получить списки всех рыб по типам
      operationId: getFishLists
      responses:
        '200':
          $ref: '#/components/responses/FishCollectionsResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /Carp:
    post:
      summary: Создать нового карпа
      operationId: createCarp
      requestBody:
        $ref: '#/components/requestBodies/CarpCreate'
      responses:
        '201':
          $ref: '#/components/responses/CarpCreated'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /Carp/{id}:
    parameters:
      - $ref: '#/components/parameters/FishId'
    get:
      summary: Получить данные карпа
      operationId: getCarpById
      responses:
        '200':
          $ref: '#/components/responses/CarpResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Обновить данные карпа
      operationId: updateCarp
      requestBody:
        $ref: '#/components/requestBodies/CarpUpdate'
      responses:
        '200':
          $ref: '#/components/responses/CarpResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Удалить карпа
      operationId: deleteCarp
      responses:
        '200':
          $ref: '#/components/responses/Deleted'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /Mackerel:
    post:
      summary: Создать новую скумбрию
      operationId: createMackerel
      requestBody:
        $ref: '#/components/requestBodies/MackerelCreate'
      responses:
        '201':
          $ref: '#/components/responses/MackerelCreated'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /Mackerel/{id}:
    parameters:
      - $ref: '#/components/parameters/FishId'
    get:
      summary: Получить данные скумбрии
      operationId: getMackerelById
      responses:
        '200':
          $ref: '#/components/responses/MackerelResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Обновить данные скумбрии
      operationId: updateMackerel
      requestBody:
        $ref: '#/components/requestBodies/MackerelUpdate'
      responses:
        '200':
          $ref: '#/components/responses/MackerelResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Удалить скумбрию
      operationId: deleteMackerel
      responses:
        '200':
          $ref: '#/components/responses/Deleted'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  parameters:
    FishId:
      name: id
      in: path
      required: true
      description: Уникальный идентификатор объекта
      schema:
        type: integer
        format: int32
        minimum: 1
  schemas:
    ErrorResponse:
      type: object
      required:
        - code
        - description
      properties:
        code:
          type: string
          description: Короткий код ошибки.
          example: NotFound
        description:
          type: string
          description: Человеко-читаемое описание ошибки.
          example: Объект не найден
        errors:
          type: array
          description: Дополнительные подробности об ошибке.
          items:
            type: string
    Fish:
      type: object
      required:
        - id
        - typeName
        - weight
        - age
        - isEdible
      properties:
        id:
          type: integer
          format: int32
          readOnly: true
          description: Уникальный идентификатор, назначаемый сервером.
        typeName:
          type: string
          readOnly: true
          description: Имя конкретного типа для десериализации.
          example: Fish
        weight:
          type: number
          format: decimal
          description: Вес рыбы в граммах.
        age:
          type: integer
          format: int32
          description: Возраст рыбы в годах.
        isEdible:
          type: boolean
          description: Является ли рыба съедобной.
    FreshwaterFish:
      allOf:
        - $ref: '#/components/schemas/Fish'
        - type: object
          required:
            - habitatDepth
          properties:
            habitatDepth:
              type: number
              format: decimal
              description: Глубина обитания в метрах.
    SaltwaterFish:
      allOf:
        - $ref: '#/components/schemas/Fish'
        - type: object
          required:
            - salinity
          properties:
            salinity:
              type: number
              format: decimal
              description: Соленость воды в промилле.
    Carp:
      allOf:
        - $ref: '#/components/schemas/FreshwaterFish'
        - type: object
          required:
            - scaleColor
          properties:
            scaleColor:
              type: string
              description: Цвет чешуи карпа.
              example: Золотистый
    Mackerel:
      allOf:
        - $ref: '#/components/schemas/SaltwaterFish'
        - type: object
          required:
            - gillSize
          properties:
            gillSize:
              type: number
              format: decimal
              description: Размер жабр скумбрии.
    FishCollections:
      type: object
      properties:
        carps:
          type: array
          description: Список всех карпов.
          items:
            $ref: '#/components/schemas/Carp'
        mackerels:
          type: array
          description: Список всех скумбрий.
          items:
            $ref: '#/components/schemas/Mackerel'
  requestBodies:
    CarpCreate:
      description: Данные для создания карпа. Поля id и typeName игнорируются сервером.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Carp'
    CarpUpdate:
      description: Данные для обновления карпа. Идентификатор задается в пути.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Carp'
    MackerelCreate:
      description: Данные для создания скумбрии. Поля id и typeName игнорируются сервером.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Mackerel'
    MackerelUpdate:
      description: Данные для обновления скумбрии. Идентификатор задается в пути.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Mackerel'
  responses:
    ValidationError:
      description: Ошибка валидации запроса.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            validation:
              summary: Некорректные данные.
              value:
                code: ValidationError
                description: Данные не прошли валидацию
                errors:
                  - Вес рыбы должен быть больше 0
    InternalServerError:
      description: Внутренняя ошибка сервера.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unexpected:
              summary: Непредвиденная ошибка.
              value:
                code: InternalServerError
                description: Произошла непредвиденная ошибка. Попробуйте позже
    FishCollectionsResponse:
      description: Списки всех рыб по типам.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/FishCollections'
    CarpCreated:
      description: Карп создан.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Carp'
    CarpResponse:
      description: Данные о карпе.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Carp'
    MackerelCreated:
      description: Скумбрия создана.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Mackerel'
    MackerelResponse:
      description: Данные о скумбрии.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Mackerel'
    Deleted:
      description: Объект удалён.
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Удалено
    NotFound:
      description: Объект не найден.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing:
              summary: Объект отсутствует.
              value:
                code: NotFound
                description: Объект не найден
    BadRequest:
      description: Некорректный запрос (неверные параметры/формат запроса).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidId:
              summary: Некорректный идентификатор в пути.
              value:
                code: BadRequest
                description: Параметр id должен быть целым числом >= 1
                errors:
                  - id: должно быть >= 1
